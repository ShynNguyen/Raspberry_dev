/******************************************************************************
 *
 * www.payitforward.edu.vn
 *
 *****************************************************************************/

/******************************************************************************
 *
 * C7 TRAINING
 *
 *****************************************************************************/

/******************************************************************************
 *
 *	Module		: UART_LCD_main.c
 *	Description	: Display characters received through UART on LCD
 *  Tool		: CCS 5.1
 *	Chip		: MSP430G2553
 * 	History		: 18/11/2012
 *  Version     : 1.1
 *
 *	Author		: Nguyen Tien Manh, CLB NCKH DDT
 *	Notes		: To apply these functions, you must include driver lcd and
 *	              uart to your project
 *
 *****************************************************************************/


/******************************************************************************
 * IMPORT
 *****************************************************************************/

#include <msp430.h>
#include "Basic_config.h"
#include "LCD.h"
#include "UART.h"


/******************************************************************************
 * EXTERN
 *****************************************************************************/

/******************************************************************************
 * GLOBAL VARIABLE
 *****************************************************************************/

/******************************************************************************
 * ROUTINES
 *****************************************************************************/

/******************************************************************************
 * MAIN
 *****************************************************************************/

void main()
{
	unsigned char c;
	signed char i = 0;
	Config_stop_WDT();
	Config_Clocks();
	lcd_init (1); // init LCD
	//lcd_backlight(1); // turn on LCD backlight
	P2SEL = 0;					//Turn off external crystal
	P2SEL2 = 0;
	uart_init ();
	delay_ms (100);

	__bis_SR_register(GIE);

	while (1)
	{
		c = uart_getc(); // cho nhan ky tu
		if (c==13) // Ky tu Enter
		{
			lcd_clear (); // Xoa lcd
			uart_puts("\r\n#MSP430>");
			i = 0;
		}
		else
		{
			if (i==16)
				lcd_gotoxy(0,1); // Xuong dong lcd
			if (i==32)
			{
				lcd_clear (); //xoa lcd
				i = 0;
			}
			i++;
			lcd_putc(c);
			uart_putc(c); // Echo
		}
	}
}

/******************************************************************************
 * END OF UART_LCD_main.c
 *****************************************************************************/
